<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üßæ Sri Dongardevi Krishi Kendra - Billing</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #fef9c3, #e0f2fe);
      color: #1e293b;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    header {
      width: 100%;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 15px 20px 80px 20px;
      text-align: center;
      line-height: 1.4;
      position: relative;
    }

    .left-logo {
      position: absolute;
      left: 20px;
      top: 10px;
      width: 110px;
      height: 110px;
      object-fit: contain;
    }

    .right-logo {
      position: absolute;
      right: 20px;
      top: 10px;
      width: 110px;
      height: 110px;
      object-fit: contain;
    }

    header h1 {
      margin: 0;
      font-size: 26px;
      color: #1e40af;
      font-weight: 700;
      text-transform: uppercase;
    }

    header p {
      margin: 2px 0;
      font-size: 14px;
      color: #475569;
    }

    .home-btn {
      align-self: flex-start;
      margin: 15px 0 0 25px;
      background: linear-gradient(90deg, #3b82f6, #22c55e);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: 0.3s;
    }

    .home-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(59, 130, 246, 0.4);
    }

    .bill-container {
      background: #fff;
      width: 90%;
      max-width: 950px;
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 12px;
    }

    th,
    td {
      border: 1px solid #cbd5e1;
      padding: 4px;
      text-align: center;
    }

    th {
      background: #f1f5f9;
      font-weight: 600;
    }

    .totals,
    .tax-summary {
      margin-top: 12px;
      width: 100%;
      font-size: 12px;
    }

    .totals td,
    .tax-summary td {
      padding: 4px;
      border: 1px solid #cbd5e1;
    }

    .totals tr:last-child td {
      font-weight: 700;
      color: #1e3a8a;
    }

    .amount-words {
      margin-top: 8px;
      font-weight: 600;
      font-size: 12px;
      color: #334155;
    }

    .btn-container {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .btn {
      padding: 10px 20px;
      background: linear-gradient(90deg, #3b82f6, #22c55e);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s ease;
      font-size: 14px;
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
    }

    .signature-box {
      margin-top: 25px;
      display: flex;
      justify-content: flex-end;
      padding-right: 40px;
      text-align: center;
    }

    .signature-line {
      border-top: 1px solid #000;
      width: 180px;
      margin-top: 40px;
      font-size: 12px;
      color: #334155;
    }

    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: #64748b;
    }

    textarea,
    input,
    select {
      font-size: 12px;
    }

    textarea {
      width: 200px;
      resize: none;
    }

    @media print {
      .btn-container,
      .home-btn {
        display: none !important;
      }

      #customerName,
      #paymentMode,
      #paidAmount {
        border: none !important;
        background: transparent !important;
      }

      #paymentMode {
        display: none !important;
      }

      #paymentModeText {
        display: inline !important;
      }

      textarea,
      input,
      select {
        outline: none !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }

    #paymentModeText {
      display: none;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <header>
    <img src="Devi.jpg.png" alt="Devi" class="left-logo">
    <img src="Logo.jpg.png" alt="Logo" class="right-logo">

    <h1>üåøSRI DONGARDEVI KRISHI KENDRAüåø</h1>
    <p><b>Dealers in:</b> Seeds, Fertilizers & Pesticides</p>
    <p><b>GSTIN:</b> 29BEOPR4412N1ZS | <b>Mobile:</b> 9731488969, 8147246006</p>
    <p><b>Address:</b> No. III-282/2, Karmagi Complex, Govt. Hospital Main Road, DONGARGAON</p>
  </header>

  <button class="home-btn" onclick="goHome()">üè† Home</button>
  <button class="home-btn" onclick="goProducts()">üõí Products</button>

  <div class="bill-container">
    <h2 style="text-align:center;color:#1e40af;">TAX INVOICE</h2>

    <div style="display:flex; justify-content:space-between; align-items:center; font-size:12px;">
      <p><b>Customer Name:</b>
        <input type="text" id="customerName" placeholder="Enter Name"
          style="padding:3px 6px; border:1px solid #cbd5e1; border-radius:4px; font-size:12px; width:200px;">
      </p>
      <p><b>Date & Time:</b> <span id="billDateTime"></span></p>
    </div>

    <p style="font-size:12px;">
      <b>Payment Mode:</b>
      <select id="paymentMode" onchange="updatePaymentFields()">
        <option value="cash">Cash</option>
        <option value="upi">UPI</option>
        <option value="unpaid">Unpaid</option>
        <option value="partial">Partial Payment</option>
      </select>
      <span id="paymentModeText"></span>
    </p>

    <div id="partialPaymentFields" style="display:none; font-size:12px;">
      <p><b>Paid Amount:</b> ‚Çπ <input type="number" id="paidAmount" oninput="updateBalance()"></p>
      <p><b>Balance Amount:</b> ‚Çπ <span id="balanceAmount">0.00</span></p>
    </div>

    <table id="billTable">
      <thead>
        <tr>
          <th>Particulars</th>
          <th>HSN/SAC</th>
          <th>Quantity</th>
          <th>Rate (Incl. Tax)</th>
          <th>Rate per Pc</th>
          <th>Amount ‚Çπ</th>
        </tr>
      </thead>
      <tbody id="billBody"></tbody>
    </table>

    <table class="totals">
      <tr>
        <td style="text-align:right;">CGST (9%)</td>
        <td style="width:120px;text-align:center;">‚Çπ <span id="cgst">0.00</span></td>
      </tr>
      <tr>
        <td style="text-align:right;">SGST (9%)</td>
        <td style="text-align:center;">‚Çπ <span id="sgst">0.00</span></td>
      </tr>
      <tr>
        <td style="text-align:right;"><b>Grand Total</b></td>
        <td style="text-align:center;"><b>‚Çπ <span id="grandTotal">0.00</span></b></td>
      </tr>
      <tr>
        <td style="text-align:right;"><b>Payment Mode</b></td>
        <td style="text-align:center;"><span id="paymentModeDisplay">-</span></td>
      </tr>
      <tr id="paidRow" style="display:none;">
        <td style="text-align:right;">Paid Amount</td>
        <td style="text-align:center;">‚Çπ <span id="paidAmountDisplay">0.00</span></td>
      </tr>
      <tr id="balanceRow" style="display:none;">
        <td style="text-align:right;">Balance Amount</td>
        <td style="text-align:center;">‚Çπ <span id="balanceAmountDisplay">0.00</span></td>
      </tr>
    </table>

    <p class="amount-words">Amount in Words: <span id="amountWords"></span></p>

    <table class="tax-summary">
      <thead>
        <tr>
          <th>Taxable Value ‚Çπ</th>
          <th>CGST Rate</th>
          <th>CGST ‚Çπ</th>
          <th>SGST Rate</th>
          <th>SGST ‚Çπ</th>
          <th>Total Tax ‚Çπ</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="taxableValue">0.00</td>
          <td>9%</td>
          <td id="cgstTax">0.00</td>
          <td>9%</td>
          <td id="sgstTax">0.00</td>
          <td id="totalTax">0.00</td>
        </tr>
      </tbody>
    </table>

    <p class="amount-words">Tax Amount in Words: <span id="taxAmountWords"></span></p>

    <div class="signature-box">
      <div class="signature-line">Authorized Signature</div>
    </div>

    <div class="btn-container">
      <button class="btn" onclick="window.print()">üñ®Ô∏è Print Bill</button>
      <button class="btn" onclick="saveBill()">üíæ Save Bill</button>
      <button class="btn" onclick="clearBill()">üóëÔ∏è Clear Bill</button>
    </div>
  </div>

  <footer>Goods once sold will not be taken back. | ¬© 2025 Sri Dongardevi Krishi Kendra</footer>

  <script>
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const billBody = document.getElementById("billBody");

  let subtotal = 0;     // taxable value (without GST)
  let grandTotal = 0;   // final with GST

  // ‚úÖ Number to Words (Indian format)
  function numberToWords(num) {
    const ones = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
    const teens = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
    const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];

    function convert(n) {
      if (n < 10) return ones[n];
      if (n < 20) return teens[n - 10];
      if (n < 100) return tens[Math.floor(n / 10)] + " " + ones[n % 10];
      if (n < 1000) return ones[Math.floor(n / 100)] + " Hundred " + convert(n % 100);
      if (n < 100000) return convert(Math.floor(n / 1000)) + " Thousand " + convert(n % 1000);
      if (n < 10000000) return convert(Math.floor(n / 100000)) + " Lakh " + convert(n % 100000);
      return convert(Math.floor(n / 10000000)) + " Crore " + convert(n % 10000000);
    }

    if (num === 0) return "Zero";
    return convert(Math.floor(num)).replace(/\s+/g, " ").trim();
  }

  function loadBill() {
    billBody.innerHTML = "";
    subtotal = 0;

    cart.forEach(p => {
      const qty = parseInt(p.selectedQty) || 1;

      const rateIncl = parseFloat(p.rateIncl || p.price || 0);
      const ratePc = rateIncl / 1.18; // without GST
      const amount = qty * rateIncl;

      subtotal += qty * ratePc;

      billBody.innerHTML += `
        <tr>
          <td>${p.name}</td>
          <td>${p.hsn || "-"}</td>
          <td>${qty}</td>
          <td>${rateIncl.toFixed(2)}</td>
          <td>${ratePc.toFixed(2)}</td>
          <td>${amount.toFixed(2)}</td>
        </tr>
      `;
    });

    const cgst = subtotal * 0.09;
    const sgst = subtotal * 0.09;
    const totalTax = cgst + sgst;

    grandTotal = subtotal + totalTax;

    document.getElementById("cgst").textContent = cgst.toFixed(2);
    document.getElementById("sgst").textContent = sgst.toFixed(2);
    document.getElementById("grandTotal").textContent = grandTotal.toFixed(2);

    document.getElementById("taxableValue").textContent = subtotal.toFixed(2);
    document.getElementById("cgstTax").textContent = cgst.toFixed(2);
    document.getElementById("sgstTax").textContent = sgst.toFixed(2);
    document.getElementById("totalTax").textContent = totalTax.toFixed(2);

    // ‚úÖ Amount in words
    document.getElementById("amountWords").textContent =
      numberToWords(Math.round(grandTotal)) + " Rupees Only";

    document.getElementById("taxAmountWords").textContent =
      numberToWords(Math.round(totalTax)) + " Rupees Only";

    // payment mode display
    const mode = document.getElementById("paymentMode").value;
    document.getElementById("paymentModeDisplay").textContent = mode.toUpperCase();

    updateBalance(); // recalc balance if partial
  }

  // date time
  const now = new Date();
  document.getElementById("billDateTime").textContent =
    now.toLocaleDateString() + " " + now.toLocaleTimeString();

  loadBill();

  // ‚úÖ Payment mode handler
  function updatePaymentFields() {
    const mode = document.getElementById("paymentMode").value;
    document.getElementById("paymentModeDisplay").textContent = mode.toUpperCase();

    if (mode === "partial") {
      document.getElementById("partialPaymentFields").style.display = "block";
      document.getElementById("paidRow").style.display = "table-row";
      document.getElementById("balanceRow").style.display = "table-row";
    } else {
      document.getElementById("partialPaymentFields").style.display = "none";
      document.getElementById("paidRow").style.display = "none";
      document.getElementById("balanceRow").style.display = "none";
      document.getElementById("paidAmount").value = "";
      document.getElementById("balanceAmount").textContent = "0.00";
      document.getElementById("paidAmountDisplay").textContent = "0.00";
      document.getElementById("balanceAmountDisplay").textContent = "0.00";
    }
  }

  // ‚úÖ Auto balance calculation
  function updateBalance() {
    const paid = parseFloat(document.getElementById("paidAmount").value || 0);
    const balance = Math.max(grandTotal - paid, 0);

    document.getElementById("balanceAmount").textContent = balance.toFixed(2);
    document.getElementById("paidAmountDisplay").textContent = paid.toFixed(2);
    document.getElementById("balanceAmountDisplay").textContent = balance.toFixed(2);
  }

  updatePaymentFields();

// ‚úÖ Save Bill
async function saveBill() {
  try {
    const bill = {
      customer_name: document.getElementById("customerName").value || "Unknown",
      particular: cart.map(p => p.name).join(", "),
      quantity: Number(cart.reduce((sum, p) => sum + (parseInt(p.selectedQty) || 0), 0)),
      rate_incl_tax: Number(grandTotal),
      total_amount: Number(grandTotal),
      grand_total: Number(grandTotal),
      payment_mode: document.getElementById("paymentMode").value,
      amount_paid: Number(document.getElementById("paidAmount").value || 0),
      balance_amount: Number(document.getElementById("balanceAmount").textContent || 0)
    };

    const res = await fetch("https://krushi-kendra-backend.onrender.com/add-bill", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(bill)
    });

    const data = await res.json();

    if (!res.ok) {
      alert("‚ùå Error saving bill: " + (data.error || "Server error"));
      return;
    }

    alert("‚úÖ Bill saved successfully!");

    // ‚úÖ CLEAR BILL AFTER SAVE
    localStorage.removeItem("cart");
    clearBill();

    // ‚úÖ REDIRECT TO OWNER PAGE
    setTimeout(() => {
      window.location.href = "Owner.html";
    }, 500);

  } catch (err) {
    alert("‚ùå Error saving bill.");
  }
}


  // ‚úÖ GO HOME
  function goHome() {
    window.location.href = "index.html";
  }

  // ‚úÖ GO PRODUCTS
  function goProducts() {
    window.location.href = "Products.html";
  }

  // ‚úÖ CLEAR BILL
  function clearBill() {
    if (!confirm("Clear all bill items?")) return;

    localStorage.removeItem("cart");
    document.getElementById("billBody").innerHTML = "";

    document.getElementById("cgst").textContent = "0.00";
    document.getElementById("sgst").textContent = "0.00";
    document.getElementById("grandTotal").textContent = "0.00";

    document.getElementById("taxableValue").textContent = "0.00";
    document.getElementById("cgstTax").textContent = "0.00";
    document.getElementById("sgstTax").textContent = "0.00";
    document.getElementById("totalTax").textContent = "0.00";

    document.getElementById("amountWords").textContent = "";
    document.getElementById("taxAmountWords").textContent = "";

    document.getElementById("paymentModeDisplay").textContent = "-";
    document.getElementById("customerName").value = "";
    document.getElementById("paidAmount").value = "";
    document.getElementById("balanceAmount").textContent = "0.00";
    document.getElementById("paidAmountDisplay").textContent = "0.00";
    document.getElementById("balanceAmountDisplay").textContent = "0.00";

    alert("üóëÔ∏è Bill cleared!");
  }
</script>

</body>

</html>




